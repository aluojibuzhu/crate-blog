| hvisor                                                       | hvisor_arch_loongarch                      | axvisor                                                      | axvisor_x86                                                  |
| :----------------------------------------------------------- | ------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| rust_main/install_trap_vector<br />注册异常处理              | arch::loongarch::trap::install_trap_vector | main/logo::print_logo()<br />打印logo                        |                                                              |
| rust_main/ MASTER_CPU.load<br />设置主cpu初始化堆            |                                            | main/has_hardware_support<br />查询是否支持硬件虚拟化        | x86_vcpu::has_hardware_support                               |
| rust_main/ let cpu = PerCpu::new(cpuid)<br />创建cpu         |                                            | main/enable_virtualizatio<br />**主要作用是初始化所有cpu：**<br />每核定时器初始化(只依赖于arceos module 组件？)<br /><br />每核cpu初始化<br /> | x86_vcpu::VmxPerCpuState::new()<br />x86_vcpu:VmxPerCpuState:::hardware_enable<br /> |
| rust_main/wakeup_secondary_cpus(cpu.id, host_dtb) && wait_for(\|\|PerCpu::entered_cpus() < MAX_CPU_NUM as _)<br />启动主 CPU及其他 CPU，并等待所有cpu启动完成 |                                            | main()/vmm::init()<br />初始化虚拟机配置<br />为每个虚拟机设置主cpu<br /> |                                                              |
| rust_main()/primary_init_early && wait_for_counter  <br />主 CPU执行 primary_init_early() 完成全局初始化创建虚拟机（hvisor好像只创建一个虚拟机？）<br/>创建虚拟机时会对**执行中断控制器的全局早期初始化、初始化物理内存页帧分配器、初始化事件管理系统**<br />从 CPU等待主 CPU 完成（通过 INIT_EARLY_OK 标志) |                                            |                                                              |                                                              |
| rust_main()/per_cpu_init<br />所有 CPU执行 per_cpu_init(cpu) 进行本地初始化 |                                            |                                                              |                                                              |
| rust_main()/INITED_CPUS.fetch_add && wait_for_counter<br />等待所有cpu同步 |                                            |                                                              |                                                              |
| rust_main()/primary_init_late<br />主cpu后期初始化（**主要是主 CPU 的中断控制器后期初始化，如分发中断、设置优先级等**） |                                            |                                                              |                                                              |
| cpu.run_vm();<br />启动虚拟机                                |                                            |                                                              |                                                              |

